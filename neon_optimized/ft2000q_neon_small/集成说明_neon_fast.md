# dgemm_neon_fast é›†æˆè¯´æ˜

## âœ… å·²å®Œæˆçš„ä¿®æ”¹

### 1. ä¿®æ”¹äº† `dgemm_opt.h`
- âŒ åˆ é™¤äº† `dgemm_naive`ã€`dgemm_unroll`ã€`dgemm_neon` çš„å£°æ˜
- âœ… æ·»åŠ äº† `dgemm_neon_fast` çš„å‡½æ•°å£°æ˜
- âœ… æ·»åŠ äº† `dgemm_neon_fast_wrapper` åŒ…è£…å‡½æ•°ï¼ˆè‡ªåŠ¨ç®¡ç†ç¼“å†²åŒºï¼‰

### 2. ä¿®æ”¹äº† `benchmark.c`
- å°†æµ‹è¯•å‡½æ•°ä» 3 ä¸ªï¼ˆnaive, unroll, neonï¼‰æ”¹ä¸º 1 ä¸ªï¼ˆneon_fastï¼‰
- ç°åœ¨åªæµ‹è¯• `dgemm_neon_fast`

### 3. ä¿®æ”¹äº† `Makefile`
- å°†æºæ–‡ä»¶ä» `dgemm_naive.c`, `dgemm_neon.c`, `dgemm_unroll.c` æ”¹ä¸º `dgemm_neon_fast.c`
- ç°åœ¨åªç¼–è¯‘ `dgemm_neon_fast.c`

---

## ğŸš€ å¿«é€Ÿä½¿ç”¨

### æ–¹æ³•1ï¼šä½¿ç”¨è„šæœ¬ï¼ˆæ¨èï¼‰
```bash
chmod +x å¿«é€Ÿæµ‹è¯•_neon_fast.sh
./å¿«é€Ÿæµ‹è¯•_neon_fast.sh
```

### æ–¹æ³•2ï¼šæ‰‹åŠ¨å‘½ä»¤
```bash
# æ¸…ç†
make clean

# ç¼–è¯‘
make

# è¿è¡Œæµ‹è¯•
./benchmark_O0
```

### æ–¹æ³•3ï¼šæµ‹è¯•æ‰€æœ‰ä¼˜åŒ–çº§åˆ«
```bash
make test_all
```

è¿™ä¼šæµ‹è¯• O0, O1, O2 ä¸‰ä¸ªä¼˜åŒ–çº§åˆ«ï¼Œç”Ÿæˆï¼š
- `benchmark_results_O0.csv`
- `benchmark_results_O1.csv`
- `benchmark_results_O2.csv`

---

## ğŸ“Š æµ‹è¯•å†…å®¹

### æµ‹è¯•å‡½æ•°
- **dgemm_neon_fast**: ARM NEON é«˜åº¦ä¼˜åŒ–ç‰ˆæœ¬

### æµ‹è¯•ç”¨ä¾‹ï¼ˆ9ç§çŸ©é˜µè§„æ¨¡ï¼‰
1. Small_PowerOfTwo_Square (16Ã—16Ã—16)
2. Small_NonPowerOfTwo_Square (24Ã—24Ã—24)
3. Small_NonSquare (24Ã—32Ã—16)
4. Medium_NonPowerOfTwo_Square (96Ã—96Ã—96)
5. Medium_PowerOfTwo_Square (128Ã—128Ã—128)
6. Medium_NonSquare (120Ã—128Ã—96)
7. Large_NonPowerOfTwo_Square (240Ã—240Ã—240)
8. Large_PowerOfTwo_Square (256Ã—256Ã—256)
9. Large_NonSquare (256Ã—240Ã—248)

### æµ‹è¯•å‚æ•°
- æ¯ä¸ªç”¨ä¾‹è¿è¡Œ **50æ¬¡**
- è®¡ç®—å¹³å‡æ—¶é—´å’Œæ ‡å‡†å·®
- æµ‹è¯•æ¨¡å¼ï¼šMODE 0ï¼ˆå®Œå…¨å¯¹åº” op-lyb é€»è¾‘ï¼‰

---

## ğŸ“ è¾“å‡ºæ–‡ä»¶

### æµ‹è¯•åä¼šç”Ÿæˆ
```
benchmark_results.csv          # æ€§èƒ½æ•°æ®ï¼ˆCSVæ ¼å¼ï¼‰
```

### CSV æ–‡ä»¶æ ¼å¼
```csv
ä¼˜åŒ–ç‰ˆæœ¬,Small_PowerOfTwo_Square(16x16x16),Small_NonPowerOfTwo_Square(24x24x24),...
dgemm_neon_fast,0.123,0.456,...
```

---

## ğŸ”§ é«˜çº§é…ç½®

### ä¿®æ”¹æµ‹è¯•å‚æ•°

ç¼–è¾‘ `benchmark.c`ï¼š

```c
#define NUM_RUNS 50           // è¿è¡Œæ¬¡æ•°ï¼ˆå¯æ”¹ä¸º 10, 100 ç­‰ï¼‰
#define TEST_MODE 0           // æµ‹è¯•æ¨¡å¼ï¼ˆ0, 1, 2ï¼‰
#define VERIFY_CORRECTNESS 0  // æ˜¯å¦éªŒè¯æ­£ç¡®æ€§ï¼ˆ0 æˆ– 1ï¼‰
```

### ä¿®æ”¹ç¼–è¯‘ä¼˜åŒ–çº§åˆ«

```bash
# é»˜è®¤ O0
make

# æŒ‡å®š O1
make OPT_LEVEL=O1

# æŒ‡å®š O2
make OPT_LEVEL=O2

# æŒ‡å®š O3
make OPT_LEVEL=O3
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### ç¼–è¯‘é”™è¯¯ï¼šæ‰¾ä¸åˆ° dgemm_neon_fast
**åŸå› **ï¼š`dgemm_neon_fast.c` æ–‡ä»¶ä¸å­˜åœ¨æˆ–è·¯å¾„é”™è¯¯

**è§£å†³**ï¼š
```bash
ls -l dgemm_neon_fast.c   # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
```

### è¿è¡Œæ—¶æ®µé”™è¯¯
**åŸå› **ï¼šå¯èƒ½æ˜¯å†…å­˜åˆ†é…å¤±è´¥æˆ–çŸ©é˜µå¤ªå¤§

**è§£å†³**ï¼š
```bash
free -h  # æ£€æŸ¥å¯ç”¨å†…å­˜
```

### ç»“æœå¼‚å¸¸
**åŸå› **ï¼šå¯èƒ½æ˜¯ç®—æ³•é—®é¢˜

**è§£å†³**ï¼šå¯ç”¨æ­£ç¡®æ€§éªŒè¯
```c
#define VERIFY_CORRECTNESS 1
```

---

## ğŸ“ dgemm_neon_fast ç‰¹æ€§

### ä¸»è¦ä¼˜åŒ–æŠ€æœ¯
1. âœ… å‘é‡åŒ–çš„æ•°æ®æ‰“åŒ…å‡½æ•°
2. âœ… ä¼˜åŒ–çš„ 4x4 è®¡ç®—æ ¸å¿ƒ
3. âœ… é«˜æ€§èƒ½ 4x8 è®¡ç®—æ ¸å¿ƒ
4. âœ… æ™ºèƒ½å†…æ ¸é€‰æ‹©
5. âœ… æ”¹è¿›çš„é¢„å–ç­–ç•¥

### ç¼“å­˜åˆ†å—å‚æ•°
- GEMM_M = 2048
- GEMM_P = 128
- GEMM_N = 256

### é¢„æœŸæ€§èƒ½
- ç›¸æ¯”åŸç‰ˆæå‡ï¼š**15-30%**
- å¤§çŸ©é˜µï¼ˆ256Ã—256 ä»¥ä¸Šï¼‰æ•ˆæœæ›´æ˜æ˜¾

---

## ğŸ“ å®Œæ•´æµ‹è¯•å‘½ä»¤

```bash
# åœ¨ FT2000Q å¹³å°ä¸Šè¿è¡Œ
cd /path/to/ft2000q_new_test

# ç¡®ä¿è„šæœ¬å¯æ‰§è¡Œ
chmod +x å¿«é€Ÿæµ‹è¯•_neon_fast.sh

# è¿è¡Œæµ‹è¯•
./å¿«é€Ÿæµ‹è¯•_neon_fast.sh

# æŸ¥çœ‹ç»“æœ
cat benchmark_results.csv
```

---

## âœ… éªŒè¯æ£€æŸ¥æ¸…å•

- [x] `dgemm_neon_fast.c` å·²æ”¾åœ¨ ft2000q_new_test ç›®å½•
- [x] `dgemm_opt.h` å·²æ›´æ–°å£°æ˜
- [x] `benchmark.c` å·²æ›´æ–°æµ‹è¯•å‡½æ•°
- [x] `Makefile` å·²æ›´æ–°æºæ–‡ä»¶åˆ—è¡¨
- [ ] ç¼–è¯‘æˆåŠŸï¼ˆæ‰§è¡Œ `make`ï¼‰
- [ ] æµ‹è¯•è¿è¡ŒæˆåŠŸï¼ˆæ‰§è¡Œ `./benchmark_O0`ï¼‰
- [ ] ç”Ÿæˆäº† `benchmark_results.csv`

---

## ğŸ¯ ä¸‹ä¸€æ­¥

æµ‹è¯•å®Œæˆåï¼Œå¦‚æœéœ€è¦å¯¹æ¯”ä¸åŒå®ç°çš„æ€§èƒ½ï¼š
1. å¤‡ä»½å½“å‰çš„ `dgemm_neon_fast.c`
2. æ·»åŠ å…¶ä»–å®ç°æ–‡ä»¶ï¼ˆå¦‚ `dgemm_naive.c`ï¼‰
3. æ›´æ–° `dgemm_opt.h` å’Œ `benchmark.c`
4. é‡æ–°ç¼–è¯‘æµ‹è¯•

æˆ–è€…ä½¿ç”¨ `test_all_opt.sh` è„šæœ¬æµ‹è¯•æ‰€æœ‰ä¼˜åŒ–çº§åˆ«çš„æ€§èƒ½å·®å¼‚ã€‚

---

âœ… é…ç½®å®Œæˆï¼ç°åœ¨å¯ä»¥åœ¨ FT2000Q ä¸Šæµ‹è¯•äº†ï¼ğŸš€

