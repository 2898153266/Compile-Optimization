# DGEMM 测试程序编译说明

## 统一编译选项

**所有源文件统一使用 `-O2` 编译**，避免混乱。

## 编译命令

**⚠️ 重要：所有编译命令必须在 `test/` 目录中执行！**

```bash
# 0. 进入test目录（如果还没进入）
cd test
```

### 方法1：独立运行测试程序

```bash
# 1. 编译DGEMM实现（统一使用-O2）
gcc -O2 -I. -c src/dgemm_unroll.c -o dgemm_unroll.o
gcc -O2 -I. -c opt/dgemm_unroll_ass.c -o dgemm_unroll_ass.o

# 2. 编译包装函数
gcc -O2 -I. -c dgemm_wrappers.c -o dgemm_wrappers.o

# 3. 编译并链接性能测试程序
gcc -O2 benchmark.c dgemm_unroll.o dgemm_unroll_ass.o dgemm_wrappers.o -o benchmark

# 4. 运行测试
./benchmark
```

### 方法2：集成到大型程序

在你的大型程序中，将以下文件添加到编译列表，**统一使用 -O2 编译**：

```bash
# 需要编译的源文件
src/dgemm_unroll.c          # 原始实现
opt/dgemm_unroll_ass.c      # 优化实现
dgemm_wrappers.c            # 包装函数
benchmark.c                 # 性能测试（添加-DNO_MAIN）

# 编译选项
-O2 -I<test目录路径>

# 如果集成到大型程序，测试程序需要添加
-DNO_MAIN
```

### 方法3：使用接口函数

在你的大型程序中调用测试接口：

```c
#include "test_interface.h"

int main() {
    // 运行性能测试
    run_dgemm_benchmark();
    
    return 0;
}
```

编译命令：
```bash
gcc -O2 -I<test目录> your_program.c \
    src/dgemm_unroll.c \
    opt/dgemm_unroll_ass.c \
    dgemm_wrappers.c \
    benchmark.c \
    -DNO_MAIN \
    -o your_program
```

## 文件说明

### 核心实现文件
- `src/dgemm_unroll.c` - 原始循环展开实现
- `opt/dgemm_unroll_ass.c` - 内联汇编FMA优化实现
- `dgemm_wrappers.c` - 类型转换包装函数

### 头文件
- `blas_dgemm.h` - DGEMM原始声明（unsigned int接口）
- `dgemm_opt.h` - 测试用统一接口（int接口）
- `test_interface.h` - 对外接口函数声明

### 测试程序
- `benchmark.c` - 性能测试主程序

## 注意事项

1. **统一编译选项**：所有文件都用 `-O2` 编译，不要混用不同优化级别
2. **头文件路径**：确保 `-I` 参数指向test目录
3. **固定测试数据**：使用固定的256×256数组，每次测试结果可重复
4. **无外部依赖**：只需要标准C库，不依赖math.h等
5. **平台适配**：Windows平台已验证，移植到FT2000Q板子时直接编译即可

## ARM平台编译建议

在FT2000Q (ARMv8)板子上：

```bash
# 使用ARM交叉编译器或板子上的gcc
gcc -O2 -march=armv8-a -I. \
    src/dgemm_unroll.c \
    opt/dgemm_unroll_ass.c \
    dgemm_wrappers.c \
    benchmark.c \
    -o benchmark
```

**提示**：ARM平台上内联汇编版本性能可能会比x86平台好很多！
