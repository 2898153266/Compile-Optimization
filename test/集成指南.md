# DGEMM 性能测试集成指南

## 快速开始

### 1. 在你的程序中调用测试

```c
#include "test_interface.h"

int main(void) {
    // 运行DGEMM性能测试
    run_dgemm_benchmark();
    
    // 你的其他代码...
    
    return 0;
}
```

### 2. 编译你的程序

将以下文件添加到编译列表（统一使用 -O2）：

```bash
gcc -O2 -I<test目录> \
    your_main.c \
    benchmark.c \
    src/dgemm_unroll.c \
    opt/dgemm_unroll_ass.c \
    dgemm_wrappers.c \
    -DNO_MAIN \
    -o your_program
```

## 需要的文件

```
test/
├── test_interface.h        # 接口头文件
├── benchmark.c             # 性能测试实现
├── dgemm_opt.h             # DGEMM函数声明
├── blas_dgemm.h            # DGEMM原始声明
├── dgemm_wrappers.c        # 包装函数
├── src/
│   └── dgemm_unroll.c      # 原始实现
└── opt/
    └── dgemm_unroll_ass.c  # 优化实现
```

## 编译示例

### 使用 gcc 命令行

```bash
# 编译对象文件
gcc -O2 -I./test -c test/src/dgemm_unroll.c -o dgemm_unroll.o
gcc -O2 -I./test -c test/opt/dgemm_unroll_ass.c -o dgemm_unroll_ass.o
gcc -O2 -I./test -c test/dgemm_wrappers.c -o dgemm_wrappers.o

# 链接你的程序
gcc -O2 -I./test your_main.c test/benchmark.c \
    dgemm_unroll.o dgemm_unroll_ass.o dgemm_wrappers.o \
    -DNO_MAIN -o your_program
```

### 使用 CMake

```cmake
# CMakeLists.txt
cmake_minimum_required(VERSION 3.10)
project(YourProject C)

# 设置编译选项
set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -O2")

# 添加测试目录到包含路径
include_directories(test)

# 添加源文件
add_executable(your_program
    your_main.c
    test/benchmark.c
    test/src/dgemm_unroll.c
    test/opt/dgemm_unroll_ass.c
    test/dgemm_wrappers.c
)

# 为测试文件添加NO_MAIN宏
set_source_files_properties(
    test/benchmark.c
    PROPERTIES COMPILE_DEFINITIONS NO_MAIN
)
```

### 使用 Makefile

```makefile
CC = gcc
CFLAGS = -O2 -Itest

OBJS = your_main.o benchmark.o dgemm_unroll.o dgemm_unroll_ass.o dgemm_wrappers.o

your_program: $(OBJS)
	$(CC) $(CFLAGS) -o $@ $^

your_main.o: your_main.c test/test_interface.h
	$(CC) $(CFLAGS) -c $<

benchmark.o: test/benchmark.c
	$(CC) $(CFLAGS) -DNO_MAIN -c $<

dgemm_unroll.o: test/src/dgemm_unroll.c
	$(CC) $(CFLAGS) -c $<

dgemm_unroll_ass.o: test/opt/dgemm_unroll_ass.c
	$(CC) $(CFLAGS) -c $<

dgemm_wrappers.o: test/dgemm_wrappers.c
	$(CC) $(CFLAGS) -c $<

clean:
	rm -f *.o your_program
```

## 重要说明

1. **统一编译选项**：所有文件都用 `-O2` 编译
2. **NO_MAIN 宏**：benchmark.c 需要添加 `-DNO_MAIN`，这样它不会生成main函数
3. **头文件路径**：确保 `-I` 参数包含test目录
4. **无外部依赖**：只依赖标准C库
5. **输出方式**：测试结果通过 printf 输出到控制台

## ARM平台编译

在FT2000Q板子上编译：

```bash
gcc -O2 -march=armv8-a -I./test \
    your_main.c \
    test/benchmark.c \
    test/src/dgemm_unroll.c \
    test/opt/dgemm_unroll_ass.c \
    test/dgemm_wrappers.c \
    -DNO_MAIN \
    -o your_program
```
